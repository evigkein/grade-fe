<div
  #modal
  class="modal-wrapper"
  (keyup.enter)="submit.emit()"
  stopEvents
  [ngClass]="{
    'modal-wrapper--bottom-popup': mobileBottomPopup,
    'modal-wrapper--bottom-popup-background': mobileBottomPopupBackground,
    'modal-wrapper--flex': isFlexLayout,
    'modal-wrapper--rounded': isRoundedLayout,
    'modal-wrapper--scroll-content': scrollContent,
    'modal-wrapper--without-padding': isWithoutPadding,
    'modal-wrapper--with-shadow': isAddShadow,
    'modal-wrapper--flexible-heights': isFlexibleHeights,
    'modal-wrapper--fullscreen': $isFullscreenMode(),
    'modal-wrapper--snackbar': isSnackbar,
    'modal-wrapper--left-fullHeight': isLeftFullHeight,
    'modal-wrapper--right-fullHeight': isRightFullHeight,
    'modal-wrapper--sticky-header': isModalHeaderSticky,
    'modal-wrapper--content-fullHeight': isModalWrapperContentFullHeight,
    'modal-wrapper--scrollbar-not-visible': scrollbarIsNotVisible,
    'modal-open-animation': isOpen
  }"
  (scroll)="onScrollEvent()"
  (mouseClickUpDown)="onBackgroundClick()"
>
  <div
    #wrapperContent
    class="modal-wrapper__content"
    [@mobileSlideAnimation]="isOpen"
    stopEvents>
    <div
      *ngIf="isModalHeaderSticky"
      class="modal-wrapper__sticky-header"
      [class.modal-wrapper__sticky-header_shadowed]="isStickyHeaderShadowed$ | async"
      stopEvents>
      <ng-container *ngTemplateOutlet="modalHeader"></ng-container>
      <ng-container *ngTemplateOutlet="modalClose"></ng-container>
    </div>
    <div
      #layout
      tabTrap
      class="modal-layout"
      stopEvents
      [ngClass]="{
        'modal-layout--without-title': !titleText,
        'modal-layout--flexible-width': isFlexibleWidth,
        'modal-layout--mobile-full-screen': isMobileFullScreen,
        'modal-layout__push-close':
          (!mobileBottomPopup || iconClose) && !titleText && !isContentFullWidth,
        'modal-layout--text-white': backgroundColor || backgroundImage,
        'modal-layout--content-centered':isContentCentered && $isFullscreenMode()
      }"
      [style.background-color]="backgroundColor"
      [ngStyle]="{
        'background-image': backgroundImage
          ? 'url(' + backgroundImage + ')'
          : ''
      }"
    >
      <ng-container *ngIf="!isModalHeaderSticky">
        <ng-container *ngTemplateOutlet="modalHeader"></ng-container>
      </ng-container>

      <div class="modal-layout__content">
        <ng-content></ng-content>
      </div>

<!--      <ng-container *ngIf="!isModalHeaderSticky">-->
        <ng-container *ngTemplateOutlet="modalBottom"></ng-container>
<!--      </ng-container>-->
    </div>
  </div>
</div>

<ng-template #modalHeader>
  <h3
    *ngIf="titleText"
    class="modal-layout__title p-h3"
    [ngClass]="{
      'modal-layout__title--small': titleSize === modalTitleSize.small,
      'modal-layout__title--medium': titleSize === modalTitleSize.medium,
      'modal-layout__title--large': titleSize === modalTitleSize.large
    }">
    {{ titleText | translate }}
  </h3>
</ng-template>

<ng-template #modalBottom>
  <div *ngIf="submitButtonText || cancelButtonText" class="modal-layout__bottom action-buttons" [class.action-buttons--same]="isButtonsSame">
    <p-button *ngIf="cancelButtonText" [type]="cancelButtonType" width="wide" (action)="onCancel(); closeModal()">{{cancelButtonText | translate}}</p-button>
    <p-button *ngIf="submitButtonText" [type]="submitButtonType" width="wide" [isLoading]="isSubmitButtonLoading" (action)="onSubmit()">{{submitButtonText | translate}}</p-button>
  </div>
</ng-template>

<ng-template #modalClose>
  <button
    *ngIf="iconClose"
    class="modal-layout__close"
    [class.modal-layout__close--full-screen]="$isFullscreenMode()"
    [class.modal-layout__close--with-background]="iconCloseWithBackground"
    (click)="closeModal()"
    (keydown.space)="closeModal()"
    (keydown.enter)="closeModal()">
    <p-icon class="modal-layout__close-icon" size="26" icon="close"> </p-icon>
  </button>
</ng-template>
