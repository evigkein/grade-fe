import './polyfills.server.mjs';
import{j as A,m as g,t as h}from"./chunk-O3IS5F6B.mjs";import{Ha as C,Na as f,Pa as y,ka as v,qb as I}from"./chunk-3YBNO2ZJ.mjs";function F(r){if(r.invalid){let t=x(r);return w(r),console.log(r,t,"Control invalid"),t}return!1}function w(r){r instanceof g||r instanceof h?Object.values(r.controls).forEach(w):r.valid||M(r)}function M(r){r.markAsDirty(),r.markAsTouched(),r.updateValueAndValidity()}function x(r){let t=[];return m(r,t),t}function m(r,t,e=""){r instanceof g?Object.entries(r.controls).forEach(([i,n])=>m(n,t,e?`${e}.${i}`:i)):r instanceof h?r.controls.forEach((i,n)=>m(i,t,`${e}[${n}]`)):r.invalid&&t.push({name:e,value:r.value})}var c=class c{constructor(t){this.ngControl=t;this.useOnInit=!0;this.allowedPattern=/[\p{L}\p{N}]/u;this.lastKey=null}onKeyDown(t){let e=t.target;if(!this.ngControl?.control)return;let i=e.value,n=e.selectionStart??0,s=e.selectionEnd??n,l=this.extractAllowed(i),o=this.countAllowed(i.slice(0,n)),d=this.countAllowed(i.slice(n,s));if(t.key==="Backspace"||t.key==="Delete"){t.preventDefault();let u=l.split("");d>0?u.splice(o,d):t.key==="Backspace"&&o>0?u.splice(o-1,1):t.key==="Delete"&&o<u.length&&u.splice(o,1);let k=u.join(""),D=d>0?o:t.key==="Backspace"?o-1:o;this.applyMask(e,k,Math.max(0,D));return}this.lastKey=t.key}onInputChange(t){let e=t.target;if(!this.ngControl?.control||!e)return;let i=e.value,n=e.selectionStart??i.length,s=this.extractAllowed(i),l=this.countAllowed(i.slice(0,n));this.applyMask(e,s,l)}ngOnInit(){if(this.useOnInit&&this.ngControl?.value){let t=this.maskValue(this.ngControl.value);this.ngControl.control.setValue(t,{emitEvent:!1})}}applyMask(t,e,i){let n=this.maskValue(e);this.ngControl.control.setValue(n,{emitEvent:!1}),this.ngControl.viewToModelUpdate(n),requestAnimationFrame(()=>{let s=this.getCaretPosition(n,i);n.match(/^\+\d+\s?\(/)&&i<=1&&(s=n.length),t.setSelectionRange(s,s)})}extractAllowed(t){return Array.from(t).filter(e=>this.allowedPattern.test(e)).join("")}countAllowed(t){return Array.from(t).filter(e=>this.allowedPattern.test(e)).length}getCaretPosition(t,e){if(e<=0){for(let n=0;n<t.length;n++)if(/[\dA-Za-z_]/.test(t[n]))return n;return t.length}let i=0;for(let n=0;n<t.length;n++)if(/[\dA-Za-z]/.test(t[n])&&(i++,i===e))return n+1;return t.length}};c.\u0275fac=function(e){return new(e||c)(C(A))},c.\u0275dir=f({type:c,hostBindings:function(e,i){e&1&&I("keydown",function(s){return i.onKeyDown(s)})("input",function(s){return i.onInputChange(s)})},inputs:{useOnInit:"useOnInit",allowedPattern:"allowedPattern"}});var p=c;var a=class a extends p{maskValue(t){let e=(t||"").replace(/\D/g,"");e=e.slice(0,11);let i=e.slice(0,3),n=e.slice(3,6),s=e.slice(6,8),l=e.slice(8,10),o="";return i.length>0&&(o+=`(${i}`),i.length===3&&(o+=")"),n.length>0&&(o+=` ${n}`),s.length>0&&(o+=`-${s}`),l.length>0&&(o+=`-${l}`),o}};a.\u0275fac=(()=>{let t;return function(i){return(t||(t=v(a)))(i||a)}})(),a.\u0275dir=f({type:a,selectors:[["","appRussianNumberMask",""]],features:[y]});var b=a;export{F as a,b};
